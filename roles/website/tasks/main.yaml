--- 

# Website role - Deploy website files

- name: Ensure website root exists
  file:
    path: "{{ website_root }}"
    state: directory
    owner: "{{ website_user }}"
    group: "{{ website_group }}"
    mode: '0755'
  tags: deploy

- name: Copy entire website directory
  copy:
    src: "{{ playbook_dir }}/website_files/"
    dest: "{{ website_root }}/"
    owner: "{{ website_user }}"
    group: "{{ website_group }}"
    mode: '0644'
    directory_mode: '0755'
  tags: deploy

- name: Set SELinux context for website files
  sefcontext:
    target: "{{ website_root }}(/.*)?"
    setype: httpd_sys_content_t
    state: present
  tags: deploy

- name: Apply SELinux context
  command: restorecon -Rv {{ website_root }}
  changed_when: false
  tags: deploy